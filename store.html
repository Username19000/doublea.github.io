<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Double A SMP - Store</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  
  <!-- Tebex Checkout SDK -->
  <script src="https://checkout.tebex.io/js/sdk.js" async></script>
  
  <!-- External CSS -->
  <link rel="stylesheet" href="store.css">
</head>

<body>
  <nav class="navbar">
    <div class="nav-container">
      <a href="index.html" class="nav-logo">
        <img src="AA_Logo.png" alt="Logo" style="height: 32px;">
        <span>Double A SMP</span>
      </a>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="rules.html">Rules</a></li>
        <li><a href="guides.html">Guides</a></li>
        <li><a href="changelog.html">Changelog</a></li>
        <li><a href="#" class="active">Store</a></li>
      </ul>
    </div>
  </nav>

  <section class="store-hero">
    <div class="store-hero-content">
      <div class="store-badge">‚ú® Support the Server</div>
      <h1>Server Store</h1>
      <p>Unlock exclusive ranks and perks to enhance your Double A SMP experience</p>
    </div>
  </section>

  <nav class="category-nav">
    <ul class="category-list">
      <li><a href="#ranks" class="category-item active">üéñÔ∏è Ranks</a></li>
      <li><a href="#crates" class="category-item">üì¶ Crates</a></li>
      <li><a href="#cosmetics" class="category-item">‚ú® Cosmetics</a></li>
    </ul>
  </nav>

  <main class="container">
    <section id="ranks" class="products-section">
      <h2 class="section-title">Server Ranks</h2>
      <p class="section-subtitle">Click any rank to view full details and perks</p>
      <div class="products-grid" id="ranks-grid"></div>
    </section>

    <section id="crates" class="products-section">
      <h2 class="section-title">Crate Keys</h2>
      <p class="section-subtitle">Try your luck with exciting rewards</p>
      <div class="products-grid" id="crates-grid"></div>
    </section>

    <section id="cosmetics" class="products-section">
      <h2 class="section-title">Cosmetics & Utilities</h2>
      <p class="section-subtitle">Stand out and boost your gameplay</p>
      <div class="products-grid" id="cosmetics-grid"></div>
    </section>
  </main>

  <div class="modal-overlay" id="modal">
    <div class="modal-content">
      <div class="modal-header">
        <button class="modal-close" onclick="closeModal()">&times;</button>
        <div class="modal-icon" id="modal-icon"></div>
        <h2 class="modal-title" id="modal-title"></h2>
        <div class="modal-price" id="modal-price"></div>
        <div class="modal-price-subtitle" id="modal-price-subtitle"></div>
      </div>
      <div class="modal-body" id="modal-body"></div>
      <div class="modal-footer" id="modal-footer"></div>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-brand">
          <img src="AA_Logo.png" alt="Logo" style="height: 32px;">
          <span>Double A SMP</span>
        </div>
        <p class="footer-text">Support the server and unlock exclusive perks</p>
      </div>
    </div>
  </footer>

  <script>
    // ========================================
    // CONFIGURATION - REPLACE WITH YOUR TEBEX IDs
    // ========================================
    const TEBEX_CONFIG = {
      webstoreIdentifier: 'double-a-smp-store', // ‚úì This is correct!
      
      ranks: [
        {
          name: 'Resident',
          icon: 'üå±',
          badge: 'Starter',
          badgeClass: '',
          price: '$5.00',
          priceSubtitle: 'One-time purchase',
          description: 'Start your journey with essential perks',
          image: 'images/resident-preview.png', // Optional: Add image showing the rank prefix
          packageId: '7235170', // Replace with actual Tebex package ID
          subscriptionId: null,
          inGamePerks: [
            '[Resident] prefix in chat and tab list',
            'Access to /hat to put any item/block on your head',
            'Access to /tpahere to bring players to you',
            'Access to all animation commands to sit, lie, or crawl anywhere',
            'Ability to set up to 3 homes',
            'Ability to set up to 7 shops',
            'Ability to lock up to 15 blocks/entities',
            'Ability to be a member of up to 5 lands',
            'Ability to claim up to 15 chunks in your land to start',
            'Ability to have up to 25 members in your land',
            'Ability to have up to 7 areas in your land',
            'Ability to have up to 9 roles in your land',
            'Grant 7 additional claimable chunks to each land you are in',
            // You can add images to perks! Use this format:
            // { text: 'Your perk description', image: 'images/perk-example.png' }
          ],
          discordPerks: [
            'Resident hoisted Discord role',
            'Access VIP Chat',
            'Access VIP Lounge',
            'Access Leaks channel',
            'Access to priority support',
            'Ability to screenshare',
            'Ability to send images in #general'
          ]
        },
        {
          name: 'Merchant',
          icon: 'üí∞',
          badge: 'Popular',
          badgeClass: 'popular',
          price: '$10.00',
          priceSubtitle: 'One-time purchase',
          description: 'Expand your business with enhanced trading perks',
          packageId: 'MERCHANT_PACKAGE_ID',
          subscriptionId: null,
          inGamePerks: [
            'All Resident perks',
            '[Merchant] prefix',
            '/back command',
            '5 total homes',
            '25 chunk claims',
            'Green chat name',
            '10 shops',
            'Lock 25 blocks'
          ],
          discordPerks: [
            'All Resident Discord perks',
            'Merchant Discord role'
          ]
        },
        {
          name: 'Pioneer',
          icon: '‚öîÔ∏è',
          badge: 'Premium',
          badgeClass: 'premium',
          price: '$30 or $8/mo',
          priceSubtitle: 'One-time OR monthly subscription',
          description: 'Forge ahead with premium features',
          packageId: 'PIONEER_ONETIME_ID',
          subscriptionId: 'PIONEER_SUB_ID',
          inGamePerks: [
            'All Merchant perks',
            'Weekly kit with crate key',
            '/workbench command',
            '10 total homes',
            '50 chunk claims',
            'Custom chat formatting',
            '/nick command'
          ],
          discordPerks: [
            'All Merchant Discord perks',
            'Pioneer exclusive channels'
          ]
        },
        {
          name: 'Guardian',
          icon: 'üõ°Ô∏è',
          badge: 'Premium',
          badgeClass: 'premium',
          price: '$45 or $12/mo',
          priceSubtitle: 'One-time OR monthly subscription',
          description: 'Enhanced survival perks',
          packageId: 'GUARDIAN_ONETIME_ID',
          subscriptionId: 'GUARDIAN_SUB_ID',
          inGamePerks: [
            'All Pioneer perks',
            'Keep XP on death',
            '20 total homes',
            '75 chunk claims',
            'Particle effects',
            'Priority queue'
          ],
          discordPerks: [
            'All Pioneer Discord perks',
            'Priority support'
          ]
        },
        {
          name: 'Sovereign',
          icon: 'üëë',
          badge: 'Premium',
          badgeClass: 'premium',
          price: '$60 or $16/mo',
          priceSubtitle: 'One-time OR monthly subscription',
          description: 'Rule your domain',
          packageId: 'SOVEREIGN_ONETIME_ID',
          subscriptionId: 'SOVEREIGN_SUB_ID',
          inGamePerks: [
            'All Guardian perks',
            'Keep inventory on death',
            '35 total homes',
            '100 chunk claims',
            '/fly in claimed land',
            'Custom item names',
            'Cosmetic pets'
          ],
          discordPerks: [
            'All Guardian Discord perks',
            'Direct admin access'
          ]
        },
        {
          name: 'Overlord',
          icon: '‚ö°',
          badge: 'Ultimate',
          badgeClass: 'premium',
          price: '$75 or $20/mo',
          priceSubtitle: 'One-time OR monthly subscription',
          description: 'The pinnacle of power',
          packageId: 'OVERLORD_ONETIME_ID',
          subscriptionId: 'OVERLORD_SUB_ID',
          inGamePerks: [
            'All Sovereign perks',
            'Unlimited homes',
            '150 chunk claims',
            '/fly everywhere',
            'Custom join/quit messages',
            'All cosmetics'
          ],
          discordPerks: [
            'All Sovereign Discord perks',
            'Owner access',
            'Vote on features'
          ]
        }
      ],
      
      crates: [
        { name: 'Common Crate Key', icon: 'üì¶', price: '$2.50', description: 'Basic resources and small chance at rare items', packageId: 'COMMON_CRATE_ID' },
        { name: 'Rare Crate Key', icon: 'üíé', price: '$5.00', description: 'Enchanted gear and valuable resources', packageId: 'RARE_CRATE_ID' },
        { name: 'Legendary Crate Key', icon: '‚≠ê', price: '$10.00', description: 'Ultimate rewards and rare spawners', packageId: 'LEGENDARY_CRATE_ID' }
      ],
      
      cosmetics: [
        { name: 'Particle Pack', icon: '‚ú®', price: '$3.00', description: '5 unique particle effects', packageId: 'PARTICLE_ID' },
        { name: 'Cosmetic Pet', icon: 'üêæ', price: '$5.00', description: 'Loyal companion', packageId: 'PET_ID' },
        { name: '$10k Money', icon: 'üíµ', price: '$5.00', description: 'Instant cash injection', packageId: 'MONEY_ID' }
      ]
    };

    // Initialize Tebex
    if (typeof Tebex !== 'undefined') {
      Tebex.checkout.init({ ident: TEBEX_CONFIG.webstoreIdentifier });
    }

    // Render functions
    function renderRanks() {
      const grid = document.getElementById('ranks-grid');
      grid.innerHTML = TEBEX_CONFIG.ranks.map(rank => `
        <div class="product-card" onclick="openRankModal('${rank.name}')">
          ${rank.badge ? `<span class="product-badge ${rank.badgeClass}">${rank.badge}</span>` : ''}
          ${rank.image ? `<img src="${rank.image}" alt="${rank.name} Preview" class="product-image">` : `<div class="product-icon">${rank.icon}</div>`}
          <h3 class="product-title">${rank.name}</h3>
          <div class="product-price">${rank.price}</div>
          <p class="product-price-sub">${rank.priceSubtitle}</p>
          <p class="product-description">${rank.description}</p>
          <div class="view-details-text">View Full Details ‚Üí</div>
        </div>
      `).join('');
    }

    function renderCrates() {
      const grid = document.getElementById('crates-grid');
      grid.innerHTML = TEBEX_CONFIG.crates.map(c => `
        <div class="product-card" onclick="buyItem('${c.packageId}')">
          <div class="product-icon">${c.icon}</div>
          <h3 class="product-title">${c.name}</h3>
          <div class="product-price">${c.price}</div>
          <p class="product-description">${c.description}</p>
          <div class="view-details-text">Purchase ‚Üí</div>
        </div>
      `).join('');
    }

    function renderCosmetics() {
      const grid = document.getElementById('cosmetics-grid');
      grid.innerHTML = TEBEX_CONFIG.cosmetics.map(c => `
        <div class="product-card" onclick="buyItem('${c.packageId}')">
          <div class="product-icon">${c.icon}</div>
          <h3 class="product-title">${c.name}</h3>
          <div class="product-price">${c.price}</div>
          <p class="product-description">${c.description}</p>
          <div class="view-details-text">Purchase ‚Üí</div>
        </div>
      `).join('');
    }

    function openRankModal(rankName) {
      const rank = TEBEX_CONFIG.ranks.find(r => r.name === rankName);
      if (!rank) return;

      document.getElementById('modal-icon').innerHTML = rank.image 
        ? `<img src="${rank.image}" alt="${rank.name}" class="modal-image">` 
        : rank.icon;
      document.getElementById('modal-title').textContent = rank.name;
      document.getElementById('modal-price').textContent = rank.price;
      document.getElementById('modal-price-subtitle').textContent = rank.priceSubtitle;

      let perksHtml = '';
      if (rank.inGamePerks?.length) {
        perksHtml += `
          <div class="perk-section">
            <h3 class="perk-section-title">In-Game Perks</h3>
            <ul class="perk-list">
              ${rank.inGamePerks.map(p => {
                // Check if perk is an object with image
                if (typeof p === 'object' && p.text) {
                  return `
                    <li>
                      <span class="perk-icon">‚úì</span>
                      <div>
                        <span>${p.text}</span>
                        ${p.image ? `<img src="${p.image}" alt="${p.text}" class="perk-image">` : ''}
                      </div>
                    </li>
                  `;
                }
                // Regular text perk
                return `<li><span class="perk-icon">‚úì</span><span>${p}</span></li>`;
              }).join('')}
            </ul>
          </div>
        `;
      }

      if (rank.discordPerks?.length) {
        perksHtml += `
          <div class="perk-section">
            <h3 class="perk-section-title">Discord Perks</h3>
            <ul class="perk-list">
              ${rank.discordPerks.map(p => {
                if (typeof p === 'object' && p.text) {
                  return `
                    <li>
                      <span class="perk-icon">‚úì</span>
                      <div>
                        <span>${p.text}</span>
                        ${p.image ? `<img src="${p.image}" alt="${p.text}" class="perk-image">` : ''}
                      </div>
                    </li>
                  `;
                }
                return `<li><span class="perk-icon">‚úì</span><span>${p}</span></li>`;
              }).join('')}
            </ul>
          </div>
        `;
      }

      document.getElementById('modal-body').innerHTML = perksHtml;

      let footerHtml = '';
      if (rank.subscriptionId) {
        footerHtml = `
          <div class="button-group">
            <button class="buy-btn" onclick="buyItem('${rank.packageId}')">
              <span class="btn-label">One-Time</span>
              ${rank.price.split(' or ')[0]}
            </button>
            <button class="buy-btn subscription" onclick="buyItem('${rank.subscriptionId}')">
              <span class="btn-label">Subscription</span>
              ${rank.price.split(' or ')[1] || 'Subscribe'}
            </button>
          </div>
        `;
      } else {
        footerHtml = `<button class="buy-btn" onclick="buyItem('${rank.packageId}')">Purchase ${rank.price}</button>`;
      }

      document.getElementById('modal-footer').innerHTML = footerHtml;
      document.getElementById('modal').classList.add('active');
    }

    function closeModal() {
      document.getElementById('modal').classList.remove('active');
    }

    // ========================================
    // TEBEX INTEGRATION METHODS
    // ========================================
    
    // METHOD 1: Basket API (Works for unapproved/test stores)
    // Adds package to basket then redirects to checkout
    function buyItemDirect(packageId) {
      if (packageId.includes('_ID')) {
        alert('Please replace package IDs in the configuration with your actual Tebex package IDs from your Tebex dashboard.');
        return;
      }
      
      // Use Tebex's add-to-basket URL - this automatically:
      // 1. Adds item to basket
      // 2. Redirects to checkout page
      const url = `https://double-a-smp-store.tebex.io/checkout/packages/add/${packageId}/single`;
      window.location.href = url; // Same tab redirect (can change to window.open for new tab)
    }
    
    // METHOD 2: Tebex SDK (Embedded checkout modal)
    // Keeps users on your site with a modal checkout
    let tebexInitialized = false;
    
    function initTebexSDK() {
      // The SDK creates a global 'Tebex' object when loaded
      // Check if it exists and has the checkout methods
      if (typeof Tebex !== 'undefined') {
        console.log('‚úì Tebex object found');
        
        if (typeof Tebex.Checkout !== 'undefined') {
          console.log('‚úì Tebex.Checkout available');
          tebexInitialized = true;
          return true;
        } else if (typeof Tebex.checkout !== 'undefined') {
          console.log('‚úì Tebex.checkout available');
          tebexInitialized = true;
          return true;
        } else {
          console.warn('‚ö† Tebex object exists but checkout not found. Available methods:', Object.keys(Tebex));
        }
      } else {
        console.warn('‚ö† Tebex SDK not loaded - the <script> tag may not have loaded yet');
      }
      return false;
    }
    
    function buyItemSDK(packageId) {
      if (packageId.includes('_ID')) {
        alert('Please replace package IDs with your actual Tebex package IDs.');
        return;
      }
      
      // Try to initialize if not already done
      if (!tebexInitialized) {
        initTebexSDK();
      }
      
      // Check for Tebex SDK - try multiple possible API formats
      if (typeof Tebex !== 'undefined') {
        try {
          // Try format 1: Tebex.Checkout.popup
          if (Tebex.Checkout && typeof Tebex.Checkout.popup === 'function') {
            console.log('Using Tebex.Checkout.popup');
            Tebex.Checkout.popup({
              ident: TEBEX_CONFIG.webstoreIdentifier,
              package: packageId
            });
            return;
          }
          
          // Try format 2: Tebex.checkout.open
          if (Tebex.checkout && typeof Tebex.checkout.open === 'function') {
            console.log('Using Tebex.checkout.open');
            Tebex.checkout.open({
              ident: TEBEX_CONFIG.webstoreIdentifier,
              package: packageId
            });
            return;
          }
          
          // Try format 3: Direct Tebex.popup
          if (typeof Tebex.popup === 'function') {
            console.log('Using Tebex.popup');
            Tebex.popup({
              ident: TEBEX_CONFIG.webstoreIdentifier,
              package: packageId
            });
            return;
          }
          
          console.error('Tebex SDK loaded but no known checkout method found');
          console.log('Available Tebex methods:', Object.keys(Tebex));
        } catch (error) {
          console.error('Tebex SDK error:', error);
        }
      }
      
      // Fallback to direct checkout if SDK doesn't work
      console.warn('Tebex SDK not working, falling back to direct checkout');
      buyItemDirect(packageId);
    }
    
    // To switch to SDK method, change this line: (buyItemDirect or buyItemSDK)
    const buyItem = buyItemDirect;
    
    // Initialize SDK on page load (in case you switch to SDK method later)
    window.addEventListener('load', function() {
      setTimeout(initTebexSDK, 1000); // Give SDK time to load
    });

    
    // Initialize SDK on page load (in case you switch to SDK method)
    window.addEventListener('load', initTebexSDK);

    // Click outside modal to close
    document.getElementById('modal').addEventListener('click', function(e) {
      if (e.target === this) closeModal();
    });

    // Initialize
    renderRanks();
    renderCrates();
    renderCosmetics();

    // Smooth scroll
    document.querySelectorAll('.category-item').forEach(item => {
      item.addEventListener('click', function(e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          document.querySelectorAll('.category-item').forEach(c => c.classList.remove('active'));
          this.classList.add('active');
        }
      });
    });
  </script>
</body>
</html>