<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Double A SMP - Store</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  
  <!-- Tebex.js for embedded checkout -->
  <script src="https://js.tebex.io/v/1.js" defer></script>
  
  <!-- External CSS -->
  <link rel="stylesheet" href="store.css">
</head>

<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="nav-container">
      <a href="index.html" class="nav-logo">
        <img src="AA_Logo.png" alt="Logo" style="height: 32px;">
        <span>Double A SMP</span>
      </a>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="rules.html">Rules</a></li>
        <li><a href="guides.html">Guides</a></li>
        <li><a href="changelog.html">Changelog</a></li>
        <li><a href="#" class="active">Store</a></li>
      </ul>
    </div>
  </nav>

  <!-- Hero -->
  <section class="store-hero">
    <div class="store-hero-content">
      <div class="store-badge">‚ú® Support the Server</div>
      <h1>Server Store</h1>
      <p>Unlock exclusive ranks and perks to enhance your Double A SMP experience</p>
      
      <!-- Username Display/Sign-in -->
      <div id="username-display" style="margin-top: 2rem;">
        <!-- Will be populated by JavaScript -->
      </div>
    </div>
  </section>

  <!-- Category Navigation -->
  <nav class="category-nav">
    <ul class="category-list">
      <li><a href="#ranks" class="category-item active" onclick="scrollToSection('ranks')">üéñÔ∏è Ranks</a></li>
      <li><a href="#crates" class="category-item" onclick="scrollToSection('crates')">üì¶ Crates</a></li>
      <li><a href="#cosmetics" class="category-item" onclick="scrollToSection('cosmetics')">‚ú® Cosmetics</a></li>
    </ul>
  </nav>

  <!-- Main Content -->
  <main class="container">
    <!-- Ranks Section -->
    <section id="ranks" class="products-section">
      <h2 class="section-title">Server Ranks</h2>
      <p class="section-subtitle">Server ranks with progressive perks - Click any rank for full details</p>
      
      <div class="products-grid" id="ranks-grid">
        <!-- YOUR CUSTOM RANK CARDS GO HERE -->
        <!-- I'll add JavaScript to make them purchasable with Headless API -->
      </div>
    </section>

    <!-- Crates Section -->
    <section id="crates" class="products-section">
      <h2 class="section-title">Mystery Crates</h2>
      <p class="section-subtitle">Random rewards and rare items</p>
      
      <div class="products-grid" id="crates-grid">
        <!-- YOUR CUSTOM CRATE CARDS -->
      </div>
    </section>

    <!-- Cosmetics Section -->
    <section id="cosmetics" class="products-section">
      <h2 class="section-title">Cosmetics & Utilities</h2>
      <p class="section-subtitle">Visual effects and convenience items</p>
      
      <div class="products-grid" id="cosmetics-grid">
        <!-- YOUR CUSTOM COSMETIC CARDS -->
      </div>
    </section>
  </main>

  <!-- Modal for package details -->
  <div class="modal-overlay" id="modal">
    <div class="modal-content">
      <div id="modal-header" class="modal-header">
        <button class="modal-close" onclick="closeModal()">&times;</button>
        <div class="modal-icon" id="modal-icon"></div>
        <h2 class="modal-title" id="modal-title"></h2>
        <div class="modal-price" id="modal-price"></div>
        <div class="modal-price-subtitle" id="modal-price-subtitle"></div>
      </div>
      <div class="modal-body" id="modal-body"></div>
      <div id="modal-footer" class="modal-footer"></div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-brand">
          <img src="AA_Logo.png" alt="Logo" style="height: 32px;">
          <span>Double A SMP</span>
        </div>
        <p class="footer-text">Support the server and unlock exclusive perks</p>
      </div>
    </div>
  </footer>

  <script>
    // ========================================
    // CONFIGURATION - YOUR CUSTOM DATA
    // ========================================
    
    const STORE_CONFIG = {
      // Tebex Headless API Token (ONLY for purchasing)
      tebexPublicToken: '11c2h-d83f9a87902177a4fb436058df6ce2f2a0569c30',
      
      // Server details
      serverIp: 'play.doubleasmp.net',
      discordInvite: 'https://discord.com/invite/h2jQRcEYvs',
      
      // Define YOUR packages with YOUR layout
      ranks: [
        {
          // Display info (YOU control this)
          name: 'Resident',
          icon: 'üå±',
          badge: 'Starter',
          badgeClass: '',
          price: 5.00,
          priceDisplay: '$5.00',
          description: 'Start your journey with essential perks',
          image: null, // or 'images/resident.png'
          
          // Tebex package IDs (for purchasing)
          packageId: 7235170, // Replace with YOUR one-time package ID
          subscriptionId: null, // If you have subscription version
          
          // Custom perks (YOUR content)
          inGamePerks: [
            '[Resident] prefix in chat and tab list',
            'Access to /hat command',
            'Access to /tpahere command',
            'Access to animation commands',
            'Ability to set up to 3 homes',
            'Ability to set up to 7 shops',
            'Ability to lock up to 15 blocks/entities',
            'Ability to claim up to 15 chunks'
          ],
          discordPerks: [
            'Resident hoisted Discord role',
            'Access VIP Chat',
            'Access VIP Lounge',
            'Access Leaks channel'
          ]
        },
        {
          name: 'Merchant',
          icon: 'üí∞',
          badge: 'Popular',
          badgeClass: 'popular',
          price: 10.00,
          priceDisplay: '$10.00',
          description: 'Enhanced trading and land abilities',
          image: null,
          packageId: 0, // YOUR PACKAGE ID
          subscriptionId: null,
          inGamePerks: [
            'All Resident perks',
            '[Merchant] prefix',
            '/back on death',
            '5 homes',
            '25 chunk claims'
          ],
          discordPerks: [
            'Merchant Discord role',
            'Priority support'
          ]
        },
        {
          name: 'Pioneer',
          icon: '‚öîÔ∏è',
          badge: 'Premium',
          badgeClass: 'premium',
          price: 30.00,
          priceDisplay: '$30.00',
          priceSubscription: 8.00,
          priceSubscriptionDisplay: '$8.00/mo',
          description: 'Unlock advanced abilities',
          image: null,
          packageId: 0, // YOUR ONE-TIME PACKAGE ID
          subscriptionId: 0, // YOUR SUBSCRIPTION PACKAGE ID
          inGamePerks: [
            'All Merchant perks',
            '[Pioneer] prefix',
            'Weekly kit',
            '/workbench command',
            '10 homes',
            '50 chunk claims'
          ],
          discordPerks: [
            'Pioneer Discord role',
            'Access to exclusive channels'
          ]
        }
        // Add more ranks...
      ],
      
      crates: [
        {
          name: 'Common Crate Key',
          icon: 'üì¶',
          badge: null,
          price: 2.50,
          priceDisplay: '$2.50',
          description: 'Basic resources and small chance at rare items',
          packageId: 0, // YOUR PACKAGE ID
          subscriptionId: null
        }
        // Add more crates...
      ],
      
      cosmetics: [
        {
          name: 'Particle Effects',
          icon: '‚ú®',
          badge: null,
          price: 5.00,
          priceDisplay: '$5.00',
          description: 'Unique visual effects',
          packageId: 0,
          subscriptionId: null
        }
        // Add more cosmetics...
      ]
    };

    // ========================================
    // USERNAME MANAGEMENT
    // ========================================
    
    let currentUsername = localStorage.getItem('minecraft_username') || '';
    
    function renderUsernameDisplay() {
      const display = document.getElementById('username-display');
      
      if (currentUsername) {
        display.innerHTML = `
          <div style="background: rgba(1, 161, 164, 0.1); border: 1px solid var(--primary); border-radius: 12px; padding: 1rem; display: inline-block;">
            <span style="color: var(--text); font-weight: 600;">Signed in as: <strong style="color: var(--primary);">${currentUsername}</strong></span>
            <button onclick="signOut()" style="margin-left: 1rem; padding: 0.5rem 1rem; background: transparent; border: 1px solid var(--primary); color: var(--primary); border-radius: 6px; cursor: pointer; font-weight: 600;">
              Sign Out
            </button>
          </div>
        `;
      } else {
        display.innerHTML = `
          <div style="background: rgba(242, 184, 65, 0.1); border: 1px solid var(--secondary); border-radius: 12px; padding: 1rem; display: inline-block;">
            <span style="color: var(--text); margin-right: 1rem;">Enter your Minecraft username to get started:</span>
            <input type="text" id="username-signin-input" placeholder="Minecraft Username" style="padding: 0.5rem 1rem; background: var(--dark); border: 1px solid var(--border); border-radius: 6px; color: var(--text); margin-right: 0.5rem;" />
            <button onclick="signIn()" style="padding: 0.5rem 1.5rem; background: var(--primary); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
              Sign In
            </button>
          </div>
        `;
      }
    }
    
    function signIn() {
      const input = document.getElementById('username-signin-input');
      const username = input.value.trim();
      
      if (!username) {
        alert('Please enter your Minecraft username');
        return;
      }
      
      currentUsername = username;
      localStorage.setItem('minecraft_username', username);
      renderUsernameDisplay();
    }
    
    function signOut() {
      if (confirm('Sign out? You\'ll need to enter your username again for purchases.')) {
        currentUsername = '';
        localStorage.removeItem('minecraft_username');
        renderUsernameDisplay();
      }
    }

    // ========================================
    // HEADLESS API (PURCHASE ONLY)
    // ========================================
    
    async function createBasket(username) {
      const response = await fetch(
        `https://headless.tebex.io/api/accounts/${STORE_CONFIG.tebexPublicToken}/baskets`,
        {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify({
            complete_url: window.location.href,
            cancel_url: window.location.href,
            complete_auto_redirect: false,
            username: username
          })
        }
      );
      
      if (!response.ok) {
        const error = await response.text();
        throw new Error(`Failed to create basket: ${error}`);
      }
      
      const data = await response.json();
      return data.data;
    }
    
    async function addPackageToBasket(basketIdent, packageId) {
      // First get basket to check for username_id
      const basketResponse = await fetch(
        `https://headless.tebex.io/api/accounts/${STORE_CONFIG.tebexPublicToken}/baskets/${basketIdent}`,
        { headers: { 'Accept': 'application/json' } }
      );
      const basketData = await basketResponse.json();
      const basket = basketData.data;
      
      const requestBody = {
        package_id: parseInt(packageId),
        quantity: 1
      };
      
      if (basket.username_id) {
        requestBody.variable_data = {
          username_id: basket.username_id
        };
      }
      
      console.log('Adding package to basket:', requestBody);
      
      const response = await fetch(
        `https://headless.tebex.io/api/baskets/${basketIdent}/packages`,
        {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify(requestBody)
        }
      );
      
      if (!response.ok) {
        // Get detailed error message from Tebex
        let errorMessage = `HTTP ${response.status}`;
        try {
          const errorData = await response.json();
          console.log('Tebex error response:', errorData);
          
          // Extract the actual error message
          if (errorData.error_message) {
            errorMessage = errorData.error_message;
          } else if (errorData.message) {
            errorMessage = errorData.message;
          } else if (errorData.errors && typeof errorData.errors === 'object') {
            // Sometimes errors are in an object
            const firstError = Object.values(errorData.errors)[0];
            if (Array.isArray(firstError)) {
              errorMessage = firstError[0];
            } else {
              errorMessage = firstError;
            }
          }
          
          // Common error translations
          if (response.status === 400) {
            if (errorMessage.toLowerCase().includes('limit') || errorMessage.toLowerCase().includes('already')) {
              errorMessage = 'You have already purchased this package and cannot buy it again due to purchase limits.';
            }
          }
          
        } catch (e) {
          errorMessage = `${response.status}: ${response.statusText}`;
        }
        throw new Error(errorMessage);
      }
      
      return await response.json();
    }
    
    async function purchasePackage(packageId, packageName, price, isSubscription, forUsername = null) {
      try {
        // Determine username
        let username = forUsername;
        
        // If no username passed (gift purchase), current user must be signed in
        if (!username && !currentUsername) {
          alert('‚ö†Ô∏è Please sign in with your Minecraft username first!');
          return;
        }
        
        // Use current user's username if not a gift
        if (!username) {
          username = currentUsername;
        }
        
        console.log(`Starting purchase for package ${packageId}... (Username: ${username})`);
        
        // Show loading
        const modal = document.getElementById('modal');
        const wasModalOpen = modal.classList.contains('active');
        if (wasModalOpen) closeModal();
        
        // Create basket
        const basket = await createBasket(username);
        console.log('‚úì Basket created:', basket.ident);
        
        // Add package
        await addPackageToBasket(basket.ident, packageId);
        console.log('‚úì Package added');
        
        // Launch checkout
        if (typeof Tebex !== 'undefined' && typeof Tebex.checkout !== 'undefined') {
          Tebex.checkout.init({
            ident: basket.ident,
            theme: 'dark',
            colors: [
              { name: "primary", color: "#01a1a4" },
              { name: "secondary", color: "#f2b841" }
            ]
          });
          
          Tebex.checkout.launch();
          
          // Success handler
          const isGift = (forUsername && forUsername !== currentUsername);
          const handler = function(event) {
            window.removeEventListener('tebex:checkout:complete', handler);
            showSuccessModal(packageName, price, username, isSubscription, isGift);
          };
          window.addEventListener('tebex:checkout:complete', handler);
          
        } else {
          throw new Error('Tebex.js not loaded');
        }
        
      } catch (error) {
        console.error('Purchase error:', error);
        alert(`‚ö†Ô∏è Failed to start checkout:\n\n${error.message}\n\nPlease try again or contact support.`);
      }
    }
    
    function purchaseAsGift(packageId, packageName, price, isSubscription) {
      const recipientUsername = prompt('üéÅ Enter the recipient\'s Minecraft username:');
      
      if (!recipientUsername || !recipientUsername.trim()) {
        alert('Gift cancelled - no username entered');
        return;
      }
      
      // Call purchase with recipient's username
      purchasePackage(packageId, packageName, price, isSubscription, recipientUsername.trim());
    }
    
    function showSuccessModal(packageName, price, username, isSubscription, wasGift) {
      const html = `
        <div style="text-align: center; padding: 2rem; animation: fadeInUp 0.5s ease;">
          <div style="font-size: 5rem; margin-bottom: 1rem; animation: bounceIn 0.8s ease;">${wasGift ? 'üéÅ' : 'üéâ'}</div>
          <h2 style="font-size: 2rem; font-weight: 700; margin-bottom: 1rem;">
            ${wasGift ? 'Gift Sent Successfully!' : 'Purchase Successful!'}
          </h2>
          
          <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid #10b981; border-radius: 12px; padding: 1.5rem; margin: 1.5rem 0;">
            <p style="font-size: 1.1rem; margin-bottom: 0.5rem;"><strong>${packageName}</strong></p>
            <p style="color: var(--text-muted); margin-bottom: 0.5rem;">
              ${isSubscription ? 'Monthly Subscription' : 'One-Time'}: <strong style="color: var(--primary);">$${price.toFixed(2)}</strong>
            </p>
            <p style="color: var(--text-muted);">
              ${wasGift ? 'Recipient' : 'Player'}: <strong style="color: var(--secondary);">${username}</strong>
            </p>
          </div>
          
          <div style="background: var(--dark); border: 1px solid var(--border); border-radius: 12px; padding: 1.5rem; margin: 1.5rem 0; text-align: left;">
            <h3 style="color: var(--primary); margin-bottom: 1rem; text-align: center;">‚ö° What Happens Next?</h3>
            <ul style="list-style: none; padding: 0;">
              <li style="padding: 0.75rem 0; border-bottom: 1px solid var(--border); display: flex; gap: 0.75rem;">
                <span style="color: #10b981;">‚úì</span>
                <span>Payment confirmed and processed</span>
              </li>
              <li style="padding: 0.75rem 0; border-bottom: 1px solid var(--border); display: flex; gap: 0.75rem;">
                <span style="color: #10b981;">‚úì</span>
                <span>Commands sent to server</span>
              </li>
              <li style="padding: 0.75rem 0; border-bottom: 1px solid var(--border); display: flex; gap: 0.75rem;">
                <span style="color: var(--primary);">‚è≥</span>
                <span>Perks will be applied within <strong>2-5 minutes</strong></span>
              </li>
              <li style="padding: 0.75rem 0; display: flex; gap: 0.75rem;">
                <span style="color: var(--secondary);">üéÆ</span>
                <span>Join <strong>${STORE_CONFIG.serverIp}</strong> to enjoy!</span>
              </li>
            </ul>
          </div>
          
          <div style="display: flex; gap: 1rem; margin-top: 2rem;">
            <button onclick="closeModal()" style="flex: 1; padding: 1rem; background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer;">
              Continue Shopping
            </button>
            <button onclick="closeModal(); window.location.href='${STORE_CONFIG.discordInvite}';" style="flex: 1; padding: 1rem; background: #5865f2; color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer;">
              Join Discord
            </button>
          </div>
        </div>
        
        <style>
          @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
          }
          @keyframes bounceIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
          }
        </style>
      `;
      
      const modalHeader = document.getElementById('modal-header');
      const modalFooter = document.getElementById('modal-footer');
      if (modalHeader) modalHeader.style.display = 'none';
      if (modalFooter) modalFooter.style.display = 'none';
      
      document.getElementById('modal-body').innerHTML = html;
      document.getElementById('modal').classList.add('active');
    }

    // ========================================
    // RENDER YOUR CUSTOM CARDS
    // ========================================
    
    function renderRanks() {
      const grid = document.getElementById('ranks-grid');
      grid.innerHTML = STORE_CONFIG.ranks.map(rank => `
        <div class="product-card" onclick="openRankModal('${rank.name}')">
          ${rank.badge ? `<span class="product-badge ${rank.badgeClass}">${rank.badge}</span>` : ''}
          ${rank.image ? `<img src="${rank.image}" alt="${rank.name}" class="product-image">` : `<div class="product-icon">${rank.icon}</div>`}
          <h3 class="product-title">${rank.name}</h3>
          <div class="product-price">${rank.subscriptionId ? `${rank.priceDisplay} or ${rank.priceSubscriptionDisplay}` : rank.priceDisplay}</div>
          <p class="product-description">${rank.description}</p>
          <div class="view-details-text">View Full Details ‚Üí</div>
        </div>
      `).join('');
    }
    
    function renderCrates() {
      const grid = document.getElementById('crates-grid');
      grid.innerHTML = STORE_CONFIG.crates.map(crate => `
        <div class="product-card" onclick="openSimpleModal('${crate.name}', ${crate.packageId}, ${crate.price}, false)">
          <div class="product-icon">${crate.icon}</div>
          <h3 class="product-title">${crate.name}</h3>
          <div class="product-price">${crate.priceDisplay}</div>
          <p class="product-description">${crate.description}</p>
        </div>
      `).join('');
    }
    
    function renderCosmetics() {
      const grid = document.getElementById('cosmetics-grid');
      grid.innerHTML = STORE_CONFIG.cosmetics.map(item => `
        <div class="product-card" onclick="openSimpleModal('${item.name}', ${item.packageId}, ${item.price}, false)">
          <div class="product-icon">${item.icon}</div>
          <h3 class="product-title">${item.name}</h3>
          <div class="product-price">${item.priceDisplay}</div>
          <p class="product-description">${item.description}</p>
        </div>
      `).join('');
    }
    
    function openRankModal(rankName) {
      const rank = STORE_CONFIG.ranks.find(r => r.name === rankName);
      if (!rank) return;
      
      const modalHeader = document.getElementById('modal-header');
      const modalFooter = document.getElementById('modal-footer');
      if (modalHeader) modalHeader.style.display = 'block';
      if (modalFooter) modalFooter.style.display = 'block';
      
      document.getElementById('modal-icon').innerHTML = rank.image ? 
        `<img src="${rank.image}" class="modal-image">` : 
        `<div style="font-size: 4rem;">${rank.icon}</div>`;
      document.getElementById('modal-title').textContent = rank.name;
      document.getElementById('modal-price').textContent = rank.subscriptionId ? 
        `${rank.priceDisplay} or ${rank.priceSubscriptionDisplay}` : rank.priceDisplay;
      document.getElementById('modal-price-subtitle').textContent = 
        rank.subscriptionId ? 'One-time purchase OR monthly subscription' : 'One-time purchase';
      
      let bodyHtml = '';
      
      if (rank.inGamePerks) {
        bodyHtml += `
          <div class="perk-section">
            <h3 class="perk-section-title">In-Game Perks</h3>
            <ul class="perk-list">
              ${rank.inGamePerks.map(p => `<li><span class="perk-icon">‚úì</span><span>${p}</span></li>`).join('')}
            </ul>
          </div>
        `;
      }
      
      if (rank.discordPerks) {
        bodyHtml += `
          <div class="perk-section">
            <h3 class="perk-section-title">Discord Perks</h3>
            <ul class="perk-list">
              ${rank.discordPerks.map(p => `<li><span class="perk-icon">‚úì</span><span>${p}</span></li>`).join('')}
            </ul>
          </div>
        `;
      }
      
      document.getElementById('modal-body').innerHTML = bodyHtml;
      
      let footerHtml = '';
      if (rank.subscriptionId) {
        // Dual buttons with gift option below
        footerHtml = `
          <div class="button-group">
            <button class="buy-btn" onclick="purchasePackage(${rank.packageId}, '${rank.name.replace(/'/g, "\\'")}', ${rank.price}, false)">
              <span class="btn-label">One-Time</span>
              ${rank.priceDisplay}
            </button>
            <button class="buy-btn subscription" onclick="purchasePackage(${rank.subscriptionId}, '${rank.name.replace(/'/g, "\\'")}', ${rank.priceSubscription}, true)">
              <span class="btn-label">Subscription</span>
              ${rank.priceSubscriptionDisplay}
            </button>
          </div>
          <button class="buy-btn" style="background: var(--secondary); margin-top: 1rem;" 
                  onclick="event.stopPropagation(); const isOneTime = confirm('Purchase as gift:\\n\\nClick OK for One-Time (${rank.priceDisplay})\\nClick Cancel for Subscription (${rank.priceSubscriptionDisplay})'); purchaseAsGift(isOneTime ? ${rank.packageId} : ${rank.subscriptionId}, '${rank.name.replace(/'/g, "\\'")}', isOneTime ? ${rank.price} : ${rank.priceSubscription}, !isOneTime);">
            üéÅ Purchase as Gift
          </button>
        `;
      } else {
        // Single button with gift option
        footerHtml = `
          <button class="buy-btn" onclick="purchasePackage(${rank.packageId}, '${rank.name.replace(/'/g, "\\'")}', ${rank.price}, false)">
            Purchase ${rank.priceDisplay}
          </button>
          <button class="buy-btn" style="background: var(--secondary); margin-top: 1rem;" 
                  onclick="purchaseAsGift(${rank.packageId}, '${rank.name.replace(/'/g, "\\'")}', ${rank.price}, false)">
            üéÅ Purchase as Gift
          </button>
        `;
      }
      
      document.getElementById('modal-footer').innerHTML = footerHtml;
      document.getElementById('modal').classList.add('active');
    }
    
    function openSimpleModal(name, packageId, price, isSub) {
      const modalHeader = document.getElementById('modal-header');
      const modalFooter = document.getElementById('modal-footer');
      if (modalHeader) modalHeader.style.display = 'block';
      if (modalFooter) modalFooter.style.display = 'block';
      
      document.getElementById('modal-title').textContent = name;
      document.getElementById('modal-price').textContent = `$${price.toFixed(2)}`;
      document.getElementById('modal-body').innerHTML = `<p style="text-align: center; color: var(--text-muted);">Click purchase to continue</p>`;
      document.getElementById('modal-footer').innerHTML = `
        <button class="buy-btn" onclick="purchasePackage(${packageId}, '${name.replace(/'/g, "\\'")}', ${price}, false)">
          Purchase $${price.toFixed(2)}
        </button>
        <button class="buy-btn" style="background: var(--secondary); margin-top: 1rem;" 
                onclick="purchaseAsGift(${packageId}, '${name.replace(/'/g, "\\'")}', ${price}, false)">
          üéÅ Purchase as Gift
        </button>
      `;
      document.getElementById('modal').classList.add('active');
    }
    
    function closeModal() {
      document.getElementById('modal').classList.remove('active');
    }
    
    function scrollToSection(id) {
      const el = document.getElementById(id);
      if (el) {
        const offset = 150;
        window.scrollTo({ top: el.offsetTop - offset, behavior: 'smooth' });
      }
      
      document.querySelectorAll('.category-item').forEach(item => item.classList.remove('active'));
      event.target.classList.add('active');
    }

    // ========================================
    // INITIALIZE
    // ========================================
    
    window.addEventListener('DOMContentLoaded', function() {
      renderUsernameDisplay();
      renderRanks();
      renderCrates();
      renderCosmetics();
    });
    
    document.getElementById('modal').addEventListener('click', function(e) {
      if (e.target === this) closeModal();
    });
  </script>
</body>
</html>